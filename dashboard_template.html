<!DOCTYPE html>
<html lang="en" data-theme="blue">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- iPhone Home Screen icon -->
<link rel="apple-touch-icon" sizes="180x180" href="/claude_activity/app_icon.jpg?v=20260216">

<!-- Home Screen label -->
<meta name="apple-mobile-web-app-title" content="Task Monitor">
<meta name="application-name" content="Task Monitor">

<!-- Standalone mode (no Safari chrome) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

<title>Claude Code Activity Dashboard</title>
<link rel="stylesheet" href="/shared/pi-design.css">
<link rel="stylesheet" href="/claude_activity/static/dashboard.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
</head>
<body>

<header class="header">
  <h1>Claude Code Activity Dashboard</h1>
  <div class="meta" id="headerMeta"></div>
</header>

<nav class="tabs" aria-label="Dashboard sections">
  <button class="tab active" data-tab="overview" type="button" aria-selected="true">Overview</button>
  <button class="tab" data-tab="explorer" type="button" aria-selected="false">Task Explorer</button>
  <button class="tab" data-tab="log" type="button" aria-selected="false">Action Log</button>
</nav>

<main class="content">
  <!-- OVERVIEW TAB -->
  <section id="overview" class="tab-panel active" role="tabpanel" aria-label="Overview">
    <div id="rebuildBanner" class="rebuild-banner hidden">Cache is being built in the background. Data will appear shortly.</div>
    <div class="cards" id="summaryCards"></div>
    <div class="section-group">
      <div class="section-header">
        <h3 class="section-title">Activity by Time Range</h3>
        <div class="category-pills" id="rangeChartPills" style="margin:0">
          <span class="cat-pill active" data-r="all" onclick="switchAllRanges('all')">All</span>
          <span class="cat-pill" data-r="1d" onclick="switchAllRanges('1d')">Day</span>
          <span class="cat-pill" data-r="7d" onclick="switchAllRanges('7d')">Week</span>
          <span class="cat-pill" data-r="30d" onclick="switchAllRanges('30d')">Month</span>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-box"><h3>Tool Distribution</h3><canvas id="toolPieChart" role="img" aria-label="Tool distribution donut chart"></canvas></div>
        <div class="chart-box"><h3>Top Projects by Actions</h3><canvas id="projectBarChart" role="img" aria-label="Projects ranked by action count"></canvas></div>
        <div class="chart-box"><h3>File Types Touched</h3><canvas id="fileTypeChart" role="img" aria-label="File types frequency chart"></canvas></div>
        <div class="chart-box"><h3>Cost by Project</h3><canvas id="costByProjectChart" role="img" aria-label="Estimated cost per project"></canvas></div>
      </div>
    </div>
    <div class="section-group">
      <div class="section-header">
        <h3 class="section-title">Trends Over Time</h3>
        <div class="category-pills" id="timelinePills" style="margin:0">
          <span class="cat-pill" data-g="daily" onclick="switchTimeline('daily')">Daily</span>
          <span class="cat-pill active" data-g="weekly" onclick="switchTimeline('weekly')">Weekly</span>
          <span class="cat-pill" data-g="monthly" onclick="switchTimeline('monthly')">Monthly</span>
        </div>
      </div>
      <div class="charts-grid charts-grid-3col">
        <div class="chart-box"><h3>Sessions</h3><canvas id="timelineChart" role="img" aria-label="Session count over time"></canvas></div>
        <div class="chart-box"><h3>Actions</h3><canvas id="actionsTimelineChart" role="img" aria-label="Actions over time"></canvas></div>
        <div class="chart-box"><h3>Active Time</h3><canvas id="activeTimeChart" role="img" aria-label="Active working time over time"></canvas></div>
      </div>
    </div>
  </section>

  <!-- TASK EXPLORER TAB -->
  <section id="explorer" class="tab-panel" role="tabpanel" aria-label="Task Explorer">
    <div class="explorer-controls">
      <label for="projectFilter" class="sr-only">Filter by project</label>
      <select id="projectFilter"><option value="">All Projects</option></select>
      <label for="sessionSelect" class="sr-only">Select session</label>
      <select id="sessionSelect"><option value="">Select a session...</option></select>
    </div>

    <div id="sessionLoading" class="loading-spinner hidden">
      <p>Loading session detail...</p>
    </div>

    <div id="sessionDetail" class="hidden">
      <div class="session-summary">
        <h2 id="sessionTitle"></h2>
        <div class="prompt-text" id="promptText"></div>
        <div class="conversation-flow hidden" id="conversationFlow"></div>
        <div class="meta-row" id="sessionMeta"></div>
      </div>

      <div class="detail-grid">
        <div class="chart-box"><h3>Tool Breakdown</h3><canvas id="sessionToolChart" role="img" aria-label="Session tool breakdown"></canvas></div>
        <div class="table-box"><h3>File Operations</h3><div id="fileOpsTable"></div></div>
      </div>

      <div class="detail-grid section-group">
        <div class="chart-box hidden" id="bashChartBox"><h3>Bash Command Categories</h3><canvas id="bashCatChart" role="img" aria-label="Bash command category breakdown"></canvas></div>
        <div class="table-box"><h3>Bash Commands</h3><div id="bashTable"></div></div>
      </div>

      <div id="subagentsSection"></div>
    </div>

    <div id="explorerEmpty" class="empty-state">
      <h3>Select a session to explore</h3>
      <p>Choose a project and session from the dropdowns above.</p>
    </div>
  </section>

  <!-- ACTION LOG TAB -->
  <section id="log" class="tab-panel" role="tabpanel" aria-label="Action Log">
    <div id="logContent">
      <div id="logNoSession" class="empty-state">
        <h3>No session selected</h3>
        <p>Select a session in the Task Explorer tab first, then come back here to see the full action log.</p>
      </div>
      <div id="logActive" class="hidden">
        <div class="filter-bar" id="toolFilters"></div>
        <div class="table-box">
          <table aria-label="Action log">
            <thead><tr><th>#</th><th>Time</th><th>Tool</th><th>Detail</th><th>Source</th></tr></thead>
            <tbody id="logTableBody"></tbody>
          </table>
        </div>
        <div class="pagination" id="logPagination"></div>
      </div>
    </div>
  </section>
</main>

<!-- Data injected by app.py at serve-time (must precede dashboard.js) -->
<script>
const DASHBOARD_DATA = {};
const rootPath = document.querySelector('link[rel="apple-touch-icon"]')?.href?.match(/(.*)\/app_icon/)?.[1] || '/claude_activity';
</script>
<script src="/claude_activity/static/dashboard.js" defer></script>
</body>
</html>
